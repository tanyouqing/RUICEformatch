{"version":3,"file":"Stock-CC-iZ-_x.js","sources":["../../src/data/charts/renderChart.js","../../src/pages/admin/dashboard/Stock.vue"],"sourcesContent":["import * as echarts from 'echarts'\n\nfunction calculateMA(dayCount, data) {\n  const result = []\n  for (let i = 0, len = data.length; i < len; i++) {\n    if (i < dayCount) {\n      result.push('-')\n      continue\n    }\n    let sum = 0\n    for (let j = 0; j < dayCount; j++) {\n      sum += +data[i - j][1]\n    }\n    result.push(sum / dayCount)\n  }\n  return result\n}\n\nexport function render_Kline(chartDom, rawData, stock_name) {\n  const myChart = echarts.init(chartDom)\n  const dates = rawData.map(function (item) {\n    return item[0]\n  })\n  const k_data = rawData.map(function (item) {\n    return [+item[1], +item[2], +item[3], +item[4]]\n  })\n  const option = {\n    title: {\n      text: `Stock: ${stock_name}`,\n    },\n    legend: {\n      data: ['Daily K', 'MA10', 'MA50'],\n      inactiveColor: '#777',\n    },\n    tooltip: {\n      trigger: 'axis',\n      axisPointer: {\n        animation: false,\n        type: 'cross',\n        lineStyle: {\n          color: '#376df4',\n          width: 2,\n          opacity: 1,\n        },\n      },\n    },\n    xAxis: {\n      type: 'category',\n      data: dates,\n      axisLine: { lineStyle: { color: '#8392A5' } },\n    },\n    yAxis: [\n      {\n        name: 'Price',\n        position: 'left',\n        scale: true,\n        axisLine: { lineStyle: { color: '#8392A5' } },\n        splitLine: { show: true },\n      },\n    ],\n    grid: {\n      bottom: 80,\n    },\n    dataZoom: [\n      {\n        textStyle: {\n          color: '#8392A5',\n        },\n        show: true,\n        handleIcon:\n          'path://M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\n        dataBackground: {\n          areaStyle: {\n            color: '#8392A5',\n          },\n          lineStyle: {\n            opacity: 0.8,\n            color: '#8392A5',\n          },\n        },\n        brushSelect: true,\n      },\n      {\n        type: 'inside',\n      },\n    ],\n    series: [\n      {\n        type: 'candlestick',\n        name: 'Day',\n        data: k_data,\n        itemStyle: {\n          color: '#f80101',\n          color0: '#05f516',\n          borderColor: '#FD1050',\n          borderColor0: '#05f516',\n        },\n      },\n      {\n        name: 'MA10',\n        type: 'line',\n        data: calculateMA(10, k_data),\n        smooth: true,\n        showSymbol: false,\n        lineStyle: {\n          width: 1,\n        },\n      },\n      {\n        name: 'MA50',\n        type: 'line',\n        data: calculateMA(50, k_data),\n        smooth: true,\n        showSymbol: false,\n        lineStyle: {\n          width: 1,\n        },\n      },\n    ],\n  }\n  myChart.setOption(option)\n}\n//\nexport function render_assetline(chartDom, rawData) {\n  //rawData:key: algo_name, value: [date, net_asset]\n  const myChart = echarts.init(chartDom)\n  console.log('raw_data from render_func: ', rawData)\n  const getDateList = (rawData) =>\n    rawData.map(function (item) {\n      return item[0] // or 1 ?\n    })\n  const algo_list = Object.keys(rawData)\n  let date_list = []\n  if (algo_list.length != 0) {\n    date_list = getDateList(rawData[algo_list[0]])\n  }\n\n  const assetline_series_list = []\n  for (const key of algo_list) {\n    const assetline_series = {\n      name: key,\n      type: 'line',\n      data: rawData[key].map(function (item) {\n        // data point List\n        return item[1]\n      }),\n      smooth: true,\n      showSymbol: false,\n      lineStyle: {\n        width: 1,\n      },\n    }\n    assetline_series_list.push(assetline_series)\n  }\n  const option = {\n    legend: {\n      data: algo_list,\n      inactiveColor: '#777',\n    },\n    tooltip: {\n      trigger: 'axis',\n      axisPointer: {\n        animation: false,\n        type: 'cross',\n        lineStyle: {\n          color: '#376df4',\n          width: 2,\n          opacity: 1,\n        },\n      },\n    },\n    xAxis: {\n      name: 'Date',\n      type: 'category',\n      data: date_list,\n      axisLine: { lineStyle: { color: '#8392A5' } },\n    },\n    yAxis: [\n      {\n        name: 'Net asset',\n        position: 'left',\n        scale: true,\n        axisLine: { lineStyle: { color: '#8392A5' } },\n        splitLine: { show: true },\n      },\n    ],\n    grid: {\n      bottom: 80,\n    },\n    dataZoom: [\n      {\n        textStyle: {\n          color: '#8392A5',\n        },\n        show: false,\n        handleIcon:\n          'path://M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\n        dataBackground: {\n          areaStyle: {\n            color: '#8392A5',\n          },\n          lineStyle: {\n            opacity: 0.8,\n            color: '#8392A5',\n          },\n        },\n        brushSelect: true,\n      },\n      {\n        type: 'inside',\n      },\n    ],\n    series: assetline_series_list,\n  }\n  myChart.setOption(option)\n}\n","<script lang=\"ts\" setup>\nimport { nextTick, onMounted, reactive } from 'vue'\nimport { useRoute } from 'vue-router'\nimport httpInstance from '../../../http'\nimport { render_Kline } from '../../../data/charts/renderChart'\n\ninterface StockInfo {\n  current_price: number\n  growth_amount: number\n  growth_rate: number\n  market_cap: number\n  pe_ratio: number\n  volume: number\n  daily_data: any[]\n  [key: string]: any // 允许动态属性\n}\n\ninterface IndexItem {\n  index_name: keyof typeof key2text // 严格限制为 key2text 的键\n  value: number | string\n}\n\nconst route = useRoute()\n\n// 初始化时提供所有必填属性的默认值\nconst stock_info = reactive<StockInfo>({\n  current_price: 0,\n  growth_amount: 0,\n  growth_rate: 0,\n  market_cap: 0,\n  pe_ratio: 0,\n  volume: 0,\n  daily_data: [],\n})\n\nconst formed_indices = reactive<{\n  list: IndexItem[]\n}>({\n  list: [],\n})\n\n// 添加类型声明允许字符串索引\nconst key2text: Record<string, string> = {\n  current_price: 'Current Price ( $)',\n  growth_amount: 'Growth Amount',\n  growth_rate: 'Growth Rate',\n  market_cap: 'Market Cap (billion $)',\n  pe_ratio: 'P/E Ratio',\n  volume: 'Volume',\n}\n\nonMounted(async () => {\n  console.log('Stock page mounted')\n\n  try {\n    const response = await httpInstance.get<StockInfo>(`${route.query.ticker}`)\n    Object.assign(stock_info, response.data)\n\n    console.log('stock_info: ', stock_info)\n\n    // 过滤有效键值\n    const validKeys = Object.keys(key2text)\n    formed_indices.list = Object.entries(stock_info)\n      .filter(([key]) => validKeys.includes(key))\n      .map(([key, value]) => ({\n        index_name: key as keyof typeof key2text,\n        value: key === 'market_cap' ? (Number(value) / 1e9).toFixed(3) : Number(value).toFixed(3),\n      }))\n\n    await nextTick(() => {\n      const dom = document.getElementById('k_chart')\n      if (dom && stock_info.daily_data) {\n        render_Kline(dom, stock_info.daily_data, `${route.query.ticker}`)\n      }\n    })\n  } catch (error) {\n    console.error('Error fetching stock data:', error)\n  }\n})\n</script>\n\n<template>\n  <h1 class=\"page-title font-bold\"></h1>\n  <section class=\"flex flex-col gap-4\">\n    <div id=\"main\">\n      <div class=\"left-part\">\n        <div id=\"k_chart\" style=\"height: 600px; width: 1000px\"></div>\n      </div>\n      <div class=\"right-part\">\n        <ElDescriptions\n          v-if=\"formed_indices.list.length > 0\"\n          class=\"margin-top\"\n          :column=\"1\"\n          direction=\"horizontal\"\n          size=\"large\"\n          border\n          style=\"margin-top: 10px\"\n        >\n          <ElDescriptionsItem v-for=\"item in formed_indices.list\" :key=\"item.index_name\" align=\"center\">\n            <template #label>\n              <div class=\"cell-item\" style=\"width: 130px\">\n                {{ key2text[item.index_name] || 'Unknown' }}\n                <!-- 添加安全兜底 -->\n              </div>\n            </template>\n            {{ item.value }}\n          </ElDescriptionsItem>\n        </ElDescriptions>\n      </div>\n    </div>\n  </section>\n</template>\n"],"names":["calculateMA","dayCount","data","result","i","len","sum","j","render_Kline","chartDom","rawData","stock_name","myChart","echarts.init","dates","item","k_data","option","route","useRoute","stock_info","reactive","formed_indices","key2text","onMounted","response","httpInstance","validKeys","key","value","nextTick","dom","error"],"mappings":"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"}